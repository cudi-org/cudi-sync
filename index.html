<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' wss://cudi-sync-signalin.onrender.com ws://localhost:8080; object-src 'none'; media-src 'none'; font-src 'self' https://fonts.gstatic.com; child-src 'none'; worker-src 'self';">
  <title>CUDI Sync - P2P File Transfer</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/x-icon" href="icons/icon-192x192.png">
  <link rel="stylesheet" href="./css/styles.css" />
</head>

<body>
  <header class="site-header glass">
    <div class="header-container">
      <div class="logo">
        <img src="./icons/logo-removebg-preview.png" alt="CUDI Logo" />
        <span>CUDI Sync</span>
      </div>
      <nav class="navbar" id="navbar">
        <a href="https://cudi-org.github.io/" target="_blank" rel="noopener noreferrer">Community</a>
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=breolanapp@gmail.com&su=Proyecto%20Sync" target="_blank"
          rel="noopener noreferrer">Contact</a>
      </nav>
      <button class="menu-toggle" id="menu-toggle" aria-label="Open menu">
        ☰
      </button>
    </div>
  </header>

  <main class="container glass">
    <button id="return-btn" class="return-btn" aria-label="Return to Menu">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    </button>
    <button id="settings-btn" class="settings-btn" aria-label="Settings">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path
          d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
        </path>
      </svg>
    </button>
    <button id="help-btn" class="help-btn" aria-label="Info & Privacy">
      ?
    </button>
    <h2 class="section-title">Peer-to-Peer Transfer</h2>

    <div id="menu">
      <p>What do you want to do?</p>
      <div class="buttons">
        <button id="btnCreate">Send File</button>
        <button id="btnShowJoin">Receive File</button>
      </div>
      <div class="entry-controls"
        style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px; align-items: center;">
        <div style="display: flex; gap: 10px; width: 100%; max-width: 300px;">
          <input type="text" id="aliasInput" placeholder="Your Alias (Name)" style="width: 100%;">
        </div>
        <input type="text" id="customRoomInput" placeholder="Custom Code (Optional)"
          style="width: 100%; max-width: 300px; text-align: center;">
      </div>
      <div id="recepcion" style="width: 100%; display: none">
        <input type="text" id="codigoSala" placeholder="Enter Room Code" />
        <button id="unirseBtn">Join</button>
      </div>
    </div>

    <div id="zonaTransferencia" style="display: none; width: 100%">
      <div class="drop-area" id="dropZone" tabindex="0" role="button" aria-label="Zone to upload files">
        <p>Drag & Drop files here or click to select</p>
        <input type="file" id="fileInput" hidden />
      </div>

      <div id="salaStatus">Room: —</div>
      <div id="room-controls" class="room-controls">
        <div class="control-group left">
          <button id="lock-room-btn" class="icon-btn" title="Lock Room">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
          </button>
          <span id="connection-monitor" class="monitor-text">Initializing...</span>
        </div>
        <div class="control-group right">
          <button id="panic-btn" class="panic-btn" title="PANIC: Close & Clear">PANIC</button>
        </div>
      </div>

      <div id="status">Connecting…</div>

      <div id="qrContainer"></div>

      <div id="chatContainer">
        <div id="messagesDisplay"></div>
        <div id="chatInputContainer">
          <input type="text" id="chatInput" placeholder="Type a message..." disabled />
          <button id="sendChatBtn" disabled aria-label="Send message">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>
      &copy; 2025 CUDI - Comunidad de Usuarios para la Defensa Informática | <a href="#" id="open-legal-modal"
        style="color: inherit; text-decoration: underline;">Legal Notice</a>
    </p>
  </footer>

  <div id="toast-container"></div>
  <div id="loading-overlay" class="hidden">
    <div class="spinner"></div>
    <p id="loading-message">Loading...</p>
  </div>

  <!-- Info Modal -->
  <div id="info-modal" class="modal hidden">
    <div class="modal-content glass">
      <span id="close-modal" class="close">&times;</span>
      <h3> Privacy & Security</h3>
      <p><strong>CUDI Sync</strong> uses <strong>P2P (Peer-to-Peer)</strong> technology. This means:</p>
      <ul>
        <li> Your files are <strong>NOT</strong> stored on any server.</li>
        <li> Transfer is direct from device to device.</li>
        <li> No intermediaries can read your data.</li>
      </ul>
      <p class="small-text">Technical note: To connect, devices momentarily exchange their public IPs.</p>
    </div>
  </div>

  <!-- Legal Disclaimer Modal -->
  <div id="legal-modal" class="modal hidden">
    <div class="modal-content glass">
      <h3>Legal Notice & Disclaimer</h3>
      <p>This is a P2P (Peer-to-Peer) tool. This means:</p>
      <ul>
        <li><strong>We do not store your data.</strong> Transfer is direct between devices.</li>
        <li>Your files do not pass through any intermediate storage server.</li>
      </ul>
      <p>By continuing, you accept that you are <strong>solely responsible</strong> for the content shared through this
        platform.</p>
      <div style="text-align: center; margin-top: 20px;">
        <button id="legal-accept-btn">Understood, start</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-content glass">
      <span id="close-settings-modal" class="close">&times;</span>
      <h3>Settings</h3>

      <div class="settings-group">
        <label for="stun-select">STUN Server:</label>
        <select id="stun-select">
          <option value="google">Google Default</option>
          <option value="mozilla">Mozilla Services</option>
          <option value="none">None (Local Network Only)</option>
        </select>
        <p class="setting-desc">Server used to establish the P2P connection (IP discovery).</p>
      </div>

      <div class="settings-group">
        <label for="filesize-select">Max File Size Limit:</label>
        <select id="filesize-select">
          <option value="0">No Limit</option>
          <option value="10">10 MB</option>
          <option value="50">50 MB</option>
          <option value="100">100 MB</option>
          <option value="500">500 MB</option>
          <option value="1024">1 GB</option>
        </select>
        <p class="setting-desc">Warn or block files larger than this limit.</p>
      </div>

      <div class="settings-group" id="manual-approval-group">
        <label>Manual Approval:</label>
        <label class="switch">
          <input type="checkbox" id="manual-approval-toggle">
          <span class="slider round"></span>
        </label>
        <p class="setting-desc">Require approval for each person joining.</p>
      </div>



      <div class="settings-group">
        <label>Auto-Clear Storage:</label>
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <span>Clear storage on exit</span>
          <label class="switch">
            <input type="checkbox" id="auto-clear-toggle" checked>
            <span class="slider round"></span>
          </label>
        </div>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button id="save-settings-btn">Save Settings</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script src="./js/config.js"></script>
  <script src="./js/script.js"></script>
</body>

</html>